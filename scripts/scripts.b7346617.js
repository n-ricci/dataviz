"use strict";angular.module("capitaloneApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngCsvImport"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"OverallCtrl"}).when("/explorative",{templateUrl:"views/explorative.html",controller:"ExplorativeCtrl"}).when("/descriptive",{templateUrl:"views/descriptive.html",controller:"DescriptiveCtrl"}).when("/tradespace-exploration",{templateUrl:"views/tradespace-exploration.html",controller:"TradespaceExplorationCtrl",controllerAs:"tradespaceExploration"}).otherwise({redirectTo:"/"})}]),angular.module("capitaloneApp").controller("OverallCtrl",["$scope","$http","$q","dataService",function(a,b,c,d){a.fetchingData=!0,b.get("data/movies.csv").success(function(b){var c=d3.csv.parse(b,function(a){return{title:a.title,genre:a.genre,studio:a.studio,total_gross:+a.total_gross,theaters:+a.theaters,opening_gross:+a.opening_gross,open_date:a.open_date}});d.setMovies(c),a.fetchingData=!1})}]),angular.module("capitaloneApp").directive("barchart",["$filter",function(a){function b(b,c,d){function e(){function d(){u=d3.scale.linear().range([s,0]);var a=u.domain([0,d3.max(b.data,function(a){return a.size})]).nice();w=d3.svg.axis().scale(u).orient("left"),d3.select("svg.bar-chart").selectAll(".bar").transition().duration(750).attr("y",function(b){return a(b.size)}).attr("height",function(b){return s-a(b.size)}),d3.select("svg.bar-chart").select(".y.axis").transition().duration(750).call(w)}function e(){u=d3.scale.linear().range([s,0]);var a=u.domain([0,d3.max(b.data,function(a){return a.avg_tot_gross})]).nice();w=d3.svg.axis().scale(u).orient("left"),d3.select("svg.bar-chart").selectAll(".bar").transition().duration(750).attr("y",function(b){return a(b.avg_tot_gross)}).attr("height",function(b){return s-a(b.avg_tot_gross)}),d3.select("svg.bar-chart").select(".y.axis").transition().duration(750).call(w)}function f(){u=d3.scale.linear().range([s,0]);var a=u.domain([0,d3.max(b.data,function(a){return a.avg_open_gross})]).nice();w=d3.svg.axis().scale(u).orient("left"),d3.select("svg.bar-chart").selectAll(".bar").transition().duration(750).attr("y",function(b){return a(b.avg_open_gross)}).attr("height",function(b){return s-a(b.avg_open_gross)}),d3.select("svg.bar-chart").select(".y.axis").transition().duration(750).call(w)}function g(){u=d3.scale.linear().range([s,0]);var a=u.domain([0,d3.max(b.data,function(a){return a.avg_num_theaters})]).nice();w=d3.svg.axis().scale(u).orient("left"),d3.select("svg.bar-chart").selectAll(".bar").transition().duration(750).attr("y",function(b){return a(b.avg_num_theaters)}).attr("height",function(b){return s-a(b.avg_num_theaters)}),d3.select("svg.bar-chart").select(".y.axis").transition().duration(750).call(w)}function h(){u=d3.scale.linear().range([s,0]);var a=u.domain([0,d3.max(b.data,function(a){return a.open_tot_ratio})]).nice();w=d3.svg.axis().scale(u).orient("left"),d3.select("svg.bar-chart").selectAll(".bar").transition().duration(750).attr("y",function(b){return a(b.open_tot_ratio)}).attr("height",function(b){return s-a(b.open_tot_ratio)}),d3.select("svg.bar-chart").select(".y.axis").transition().duration(750).call(w)}function i(){var a=t.domain(b.data.sort(function(a,b){return d3.ascending(a[o.name],b[o.name])}).map(function(a){return a[o.name]})).copy();d3.select("svg.bar-chart").selectAll(".bar").sort(function(b,c){return a(b[o.name])-a(c[o.name])});var c=d3.select("svg.bar-chart").transition().duration(1e3),d=function(a,b){return 30*b};c.selectAll(".bar").delay(d).attr("x",function(b){return a(b[o.name])}),c.select(".x.axis").call(v).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-.15em").attr("transform","rotate(-55)").selectAll("g").delay(d)}function j(){var a=t.domain(b.data.sort(function(a,b){return b.size-a.size}).map(function(a){return a[o.name]})).copy();d3.select("svg.bar-chart").selectAll(".bar").sort(function(b,c){return a(b[o.name])-a(c[o.name])});var c=d3.select("svg.bar-chart").transition().duration(1e3),d=function(a,b){return 30*b};c.selectAll(".bar").delay(d).attr("x",function(b){return a(b[o.name])}),c.select(".x.axis").call(v).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-.15em").attr("transform","rotate(-55)").selectAll("g").delay(d)}function k(){var a=t.domain(b.data.sort(function(a,b){return b.avg_tot_gross-a.avg_tot_gross}).map(function(a){return a[o.name]})).copy();d3.select("svg.bar-chart").selectAll(".bar").sort(function(b,c){return a(b[o.name])-a(c[o.name])});var c=d3.select("svg.bar-chart").transition().duration(1e3),d=function(a,b){return 30*b};c.selectAll(".bar").delay(d).attr("x",function(b){return a(b[o.name])}),c.select(".x.axis").call(v).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-.15em").attr("transform","rotate(-55)").selectAll("g").delay(d)}function l(){var a=t.domain(b.data.sort(function(a,b){return b.avg_open_gross-a.avg_open_gross}).map(function(a){return a[o.name]})).copy();d3.select("svg.bar-chart").selectAll(".bar").sort(function(b,c){return a(b[o.name])-a(c[o.name])});var c=d3.select("svg.bar-chart").transition().duration(1e3),d=function(a,b){return 30*b};c.selectAll(".bar").delay(d).attr("x",function(b){return a(b[o.name])}),c.select(".x.axis").call(v).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-.15em").attr("transform","rotate(-55)").selectAll("g").delay(d)}function m(){var a=t.domain(b.data.sort(function(a,b){return b.avg_num_theaters-a.avg_num_theaters}).map(function(a){return a[o.name]})).copy();d3.select("svg.bar-chart").selectAll(".bar").sort(function(b,c){return a(b[o.name])-a(c[o.name])});var c=d3.select("svg.bar-chart").transition().duration(1e3),d=function(a,b){return 30*b};c.selectAll(".bar").delay(d).attr("x",function(b){return a(b[o.name])}),c.select(".x.axis").call(v).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-.15em").attr("transform","rotate(-55)").selectAll("g").delay(d)}function n(){var a=t.domain(b.data.sort(function(a,b){return b.open_tot_ratio-a.open_tot_ratio}).map(function(a){return a[o.name]})).copy();d3.select("svg.bar-chart").selectAll(".bar").sort(function(b,c){return a(b[o.name])-a(c[o.name])});var c=d3.select("svg.bar-chart").transition().duration(1e3),d=function(a,b){return 30*b};c.selectAll(".bar").delay(d).attr("x",function(b){return a(b[o.name])}),c.select(".x.axis").call(v).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-.15em").attr("transform","rotate(-55)").selectAll("g").delay(d)}if(d3.select("svg.bar-chart").remove(),d3.select("h5#size text").remove(),d3.select("h5#avg_tot_gross text").remove(),d3.select("h5#avg_open_gross text").remove(),d3.select("h5#avg_num_theaters text").remove(),d3.select("h5#open_tot_ratio text").remove(),d3.select("div#hovered-network text").remove(),d3.select("div#hovered-network").style("background-color","#ddd").style("opacity",1),b.data&&null!=b.data){$("input#show-size").prop("checked",!0),$("input#alphabetically").prop("checked",!0);var o=b.grouping,p=b.data,q={top:5,right:20,bottom:110,left:80},r=700-q.left-q.right,s=435-q.top-q.bottom,t=d3.scale.ordinal().rangeRoundBands([0,r],.1,1),u=d3.scale.linear().range([s,0]),v=d3.svg.axis().scale(t).orient("bottom"),w=d3.svg.axis().scale(u).orient("left"),x=d3.select(c[0]).append("svg").attr("class","bar-chart").attr("width",r+q.left+q.right).attr("height",s+q.top+q.bottom).append("g").attr("transform","translate("+q.left+","+q.top+")");t.domain(p.map(function(a){return a[o.name]})),u.domain([0,d3.max(p,function(a){return a.size})]).nice(),x.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")").call(v).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-.15em").attr("transform","rotate(-55)"),x.append("g").attr("class","y axis").call(w),x.selectAll(".bar").data(p).enter().append("rect").attr("class","bar").attr("id",function(a){return"_"+a[o.key]}).style("fill","#333").attr("x",function(a){return t(a[o.name])}).attr("width",t.rangeBand()).attr("y",function(a){return u(a.size)}).attr("height",function(a){return s-u(a.size)}).on("mouseover",function(b){d3.select(this).style("cursor","pointer"),d3.select(this).classed("selected")||(d3.select("h5#size text").remove(),d3.select("h5#avg_tot_gross text").remove(),d3.select("h5#avg_open_gross text").remove(),d3.select("h5#avg_num_theaters text").remove(),d3.select("h5#open_tot_ratio text").remove(),d3.select("div#hovered-network text").remove(),d3.selectAll("rect#_"+b[o.key]).style("fill","blue").style("opacity",.7),d3.select("div#hovered-network").style("background-color","blue").style("opacity",.7).append("text").text(b[o.name]),d3.select("h5#size").append("text").text(a("number")(b.size,0)),d3.select("h5#avg_tot_gross").append("text").text(a("currency")(b.avg_tot_gross,"$",0)),d3.select("h5#avg_open_gross").append("text").text(a("currency")(b.avg_open_gross,"$",0)),d3.select("h5#avg_num_theaters").append("text").text(a("number")(b.avg_num_theaters,0)),d3.select("h5#open_tot_ratio").append("text").text(a("number")(b.open_tot_ratio,2)))}).on("mouseleave",function(c){d3.select(this).classed("selected")?(d3.select("div#hovered-network").style("background-color","blue").style("opacity",1),d3.selectAll("rect#_"+c[o.key]).style("opacity",1)):(d3.selectAll("rect#_"+c[o.key]).style("fill","#333").style("opacity",1),b.selectedbar?(d3.select("h5#size text").remove(),d3.select("h5#avg_tot_gross text").remove(),d3.select("h5#avg_open_gross text").remove(),d3.select("h5#avg_num_theaters text").remove(),d3.select("h5#open_tot_ratio text").remove(),d3.select("div#hovered-network text").remove(),d3.select("div#hovered-network").style("background-color","blue").style("opacity",1).append("text").text(b.selectedbar.key),d3.select("h5#size").append("text").text(a("number")(b.selectedbar.data.size,0)),d3.select("h5#avg_tot_gross").append("text").text(a("currency")(b.selectedbar.data.avg_tot_gross,"$",0)),d3.select("h5#avg_open_gross").append("text").text(a("currency")(b.selectedbar.data.avg_open_gross,"$",0)),d3.select("h5#avg_num_theaters").append("text").text(a("number")(b.selectedbar.data.avg_num_theaters,0)),d3.select("h5#open_tot_ratio").append("text").text(a("number")(b.selectedbar.data.open_tot_ratio,2))):(d3.select("div#hovered-network").style("background-color","#ddd").style("opacity",1),d3.select("h5#size text").remove(),d3.select("h5#avg_tot_gross text").remove(),d3.select("h5#avg_open_gross text").remove(),d3.select("h5#avg_num_theaters text").remove(),d3.select("h5#open_tot_ratio text").remove(),d3.select("div#hovered-network text").remove()))}).on("click",function(a){d3.select(this).classed("selected")?(b.$apply(function(){b.selectedbar=null}),d3.selectAll("rect#_"+a[o.key]).classed("selected",!1),d3.selectAll("rect#_"+a[o.key]).style("fill","blue").style("opacity",.7),d3.select("div#hovered-network").style("background-color","#blue").style("opacity",.7)):(b.$apply(function(){b.selectedbar={key:a[o.name],id:a[o.key],data:a}}),d3.selectAll("rect").classed("selected",!1).style("fill","#333").style("opacity",1),d3.selectAll("rect#_"+a[o.key]).classed("selected",!0),d3.selectAll("rect#_"+a[o.key]).style("fill","blue").style("opacity",1),d3.select("div#hovered-network").style("background-color","#blue").style("opacity",1))}),d3.select("input#y_size").on("change",d),d3.select("input#y_avg_tot_gross").on("change",e),d3.select("input#y_avg_open_gross").on("change",f),d3.select("input#y_avg_num_theaters").on("change",g),d3.select("input#y_open_tot_ratio").on("change",h),d3.select("input#alphabetically").on("change",i),d3.select("input#size").on("change",j),d3.select("input#avg_tot_gross").on("change",k),d3.select("input#avg_open_gross").on("change",l),d3.select("input#avg_num_theaters").on("change",m),d3.select("input#open_tot_ratio").on("change",n)}}b.$watch("data",e),b.$watch("grouping",e,!0)}return{link:b,restrict:"E",scope:{data:"=",grouping:"=",selectedbar:"="}}}]),angular.module("capitaloneApp").directive("parallelcoordinates",function(){function a(a,b,c){function d(){function c(a){h=j.indexOf(a)}function d(a){o.range()[h]=d3.event.x,j.sort(function(a,b){return o(a)-o(b)}),w.attr("transform",function(a){return"translate("+o(a)+")"}),v.attr("d",f)}function e(a){o.domain(j).rangePoints([0,m]);var b=d3.transition().duration(500);b.selectAll(".category").attr("transform",function(a){return"translate("+o(a)+")"}),b.selectAll(".foreground path").attr("d",f)}function f(a){return s(j.map(function(b){return[o(b),p[b](a[b])]}))}function g(){var a=j.filter(function(a){return!p[a].brush.empty()}),b=a.map(function(a){return p[a].brush.extent()});v.classed("fade",function(c){return!a.every(function(a,d){return b[d][0]<=c[a]&&c[a]<=b[d][1]})})}if(d3.select("svg#parallel-coordinates").remove(),a.data){var h,i=a.data,j=a.metrics,k=a.colorby,l=[50,60,40,60],m=820-l[1]-l[3],n=450-l[0]-l[2],o=d3.scale.ordinal().domain(j).rangePoints([0,m]),p={},q=function(a){return a[k]},r=d3.scale.category10(),s=d3.svg.line().interpolate("cardinal").tension(.99),t=d3.svg.axis().orient("left"),u=d3.select(b[0]).append("svg:svg").attr("id","parallel-coordinates").attr("width",m+l[1]+l[3]).attr("height",n+l[2]+l[4]).append("svg:g").attr("transform","translate("+l[3]+","+l[0]+")");j.forEach(function(a){i.forEach(function(b){b[a]=+b[a]}),p[a]=d3.scale.linear().domain([0,d3.max(i,function(b){return b[a]})]).range([n,0]).nice(),p[a].brush=d3.svg.brush().y(p[a]).on("brush",g)});var v=u.append("svg:g").attr("class","foreground").selectAll("path").data(i).enter().append("svg:path").attr("class","par-coord-line").style("stroke",function(a){return r(q(a))}).style("stroke-width","2px").style("stroke-opacity",.5).attr("d",f).on("mouseover",function(a){d3.select(this).classed("fade")||(d3.select("div#title-display").append("text").text(a.title),d3.select("div#colorby-display").style("background-color",function(){return r(q(a))}).append("text").text(a[k]),d3.selectAll("path.par-coord-line").transition().duration(100).style("stroke-opacity",.15),d3.select(this).transition().duration(100).style("stroke-opacity",1))}).on("mouseout",function(){d3.select(this).classed("fade")||(d3.select("div#colorby-display").style("background-color","#eee"),d3.select("div#title-display text").remove(),d3.select("div#colorby-display text").remove(),d3.selectAll("path.par-coord-line").transition().duration(100).style("stroke-opacity",.5),d3.select(this).transition().duration(100).style("stroke-opacity",.5))}),w=u.selectAll(".category").data(j).enter().append("svg:g").attr("class","category").attr("transform",function(a){return"translate("+o(a)+")"}).call(d3.behavior.drag().origin(function(a){return{x:o(a)}}).on("dragstart",c).on("drag",d).on("dragend",e));w.append("svg:g").attr("class","axis").each(function(a){d3.select(this).call(t.scale(p[a]))}).append("svg:text").attr("text-anchor","middle").attr("y",-9).text(String),w.append("svg:g").attr("class","brush").each(function(a){d3.select(this).call(p[a].brush)}).selectAll("rect").attr("x",-8).attr("width",16)}}a.$watch("data",d,!0),a.$watch("metrics",d,!0),a.$watch("colorby",d,!0)}return{link:a,restrict:"E",scope:{data:"=",metrics:"=",colorby:"="}}}),angular.module("capitaloneApp").controller("ExplorativeCtrl",["$scope","$http","$q","dataService",function(a,b,c,d){function e(){a.selectedBar&&(a.pcData=h.filter(function(b){return b[a.selectedGrouping.key]==a.selectedBar.id}))}function f(a){var b=["01_January","02_February","03_March","04_April","05_May","06_June","07_July","08_August","09_September","10_October","11_November","12_December"];return a.forEach(function(a,c){a.genre=a.genre.split(" / ").join("_").split(" ").join("_"),a.studio=a.studio.split(" ").join("_").split("/").join("_").split("(").join("_").split(")").join("_").split(".").join("_"),a.open_tot_ratio=100*a.opening_gross/a.total_gross,a.date_object=new Date(a.open_date),a.month=b[a.date_object.getMonth()]}),a}function g(a,b){var c=d3.nest().key(function(a){return a[b]}).rollup(function(a){var c={avg_tot_gross:d3.mean(a,function(a){return a.total_gross}),avg_open_gross:d3.mean(a,function(a){return a.opening_gross}),avg_num_theaters:d3.mean(a,function(a){return a.theaters}),sd_tot_gross:d3.deviation(a,function(a){return a.total_gross}),sd_open_gross:d3.deviation(a,function(a){return a.opening_gross}),sd_num_theaters:d3.deviation(a,function(a){return a.theaters}),open_tot_ratio:d3.sum(a,function(a){return a.opening_gross})/d3.sum(a,function(a){return a.total_gross}),size:a.length};return c[b]=a[0][b],c}).entries(a);return c.map(function(a){return a.values})}a.groupingsList=[{name:"genre",key:"genre"},{name:"studio",key:"studio"},{name:"month",key:"month"}],a.selectedGrouping=a.groupingsList[0],a.selectedBar=null,a.fetchingData=!0;var h=d.getMovies()?f(d.getMovies()):[];a.barchart_data={},a.barchart_data.genre=g(h,"genre").sort(function(a,b){return d3.ascending(a.genre,b.genre)}),a.barchart_data.studio=g(h,"studio").sort(function(a,b){return d3.ascending(a.studio,b.studio)}),a.barchart_data.month=g(h,"month").sort(function(a,b){return d3.ascending(a.month,b.month)}),a.selectedCategories=["opening_gross","total_gross","theaters"],a.colorByMetrics=["genre","studio","month"],a.colorByMetric=a.colorByMetrics[0],a.fetchUserData=function(){e()},a.$watch("selectedBar",e,!0)}]),angular.module("capitaloneApp").directive("donutchart",["$filter","$timeout",function(a,b){function c(c,d,e){function f(){function f(c){function d(a){return a.startAngle+(a.endAngle-a.startAngle)/2}function f(a,b){a.each(function(){for(var a,c=d3.select(this),d=c.text().split(/\s+/).reverse(),e=[],f=0,g=1.1,h=c.attr("y"),i=parseFloat(c.attr("dy")),j=c.text(null).append("tspan").attr("x",0).attr("y",h).attr("dy",i+"em");a=d.pop();)e.push(a),j.text(e.join(" ")),j.node().getComputedTextLength()>b&&(e.pop(),j.text(e.join(" ")),e=[a],j=c.append("tspan").attr("x",0).attr("y",h).attr("dy",++f*g+i+"em").text(a))})}var h=g.select(".slices").selectAll("path.slice").data(k(c),function(a){return a.data.label});h.enter().insert("path").style("fill",function(a){return o(a.data.label)}).attr("class","slice"),h.transition().duration(1e3).attrTween("d",function(a){this._current=this._current||a;var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return l(b(a))}}),h.on("mouseover",function(b){var c=b.endAngle-b.startAngle;.11>c&&(d3.select(".labelName text#_"+b.data.label).style("opacity",1),d3.select("polyline#_"+b.data.label).style("opacity",.3)),d3.select(this).style("fill","#333"),g.append("text").attr("id","pie-text").attr("tranform","translate(0,0)").attr("dy",".35em").attr("pointer-events","none").style("text-anchor","middle").style("font-size","12px").style("font-weight","bold").text(a("number")(b.data.size,0))}),h.on("mouseout",function(a){var b=a.endAngle-a.startAngle;.11>b&&(d3.select(".labelName text#_"+a.data.label).style("opacity",0),d3.select("polyline#_"+a.data.label).style("opacity",0)),d3.select(this).style("fill",function(a){return o(a.data.label)}),d3.select("svg#"+e.id+" text#pie-text").remove()});var i=g.select(".labelName").selectAll("text").data(k(c),function(a){return a.data.label});i.enter().append("text").attr("id",function(a){return"_"+a.data.label}).attr("dy",".35em").style("opacity",function(a){var b=a.endAngle-a.startAngle;return.11>b?0:1}).text(function(b){return b.data.label+": "+a("number")(b.value,1)+"%"}),i.transition().duration(1e3).attrTween("transform",function(a){this._current=this._current||a;var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){var c=b(a),e=m.centroid(c);return e[0]=j*(d(c)<Math.PI?1:-1),"translate("+e+")"}}).styleTween("text-anchor",function(a){this._current=this._current||a;var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){var c=b(a);return d(c)<Math.PI?"start":"end"}}).text(function(b){return b.data.label+": "+a("number")(b.value,1)+"%"}),i.exit().remove();var n=g.select(".lines").selectAll("polyline").data(k(c),function(a){return a.data.label});n.enter().append("polyline").attr("id",function(a){return"_"+a.data.label}).style("opacity",function(a){var b=a.endAngle-a.startAngle;return.11>b?0:.3}),n.transition().duration(1e3).attrTween("points",function(a){this._current=this._current||a;var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){var c=b(a),e=m.centroid(c);return e[0]=.95*j*(d(c)<Math.PI?1:-1),[l.centroid(c),m.centroid(c),e]}}),n.exit().remove(),b(function(){d3.select("svg#"+e.id+" g.labelName").selectAll("text").call(f,100)},2e3)}if(c.data&&null!=c.data){var g=d3.select(d[0]).append("svg").attr("id",e.id).append("g");g.append("g").attr("class","slices"),g.append("g").attr("class","labelName"),g.append("g").attr("class","labelValue"),g.append("g").attr("class","lines");var h=460,i=220,j=Math.min(h,i)/2,k=d3.layout.pie().sort(null).value(function(a){return a.value}),l=d3.svg.arc().outerRadius(.8*j).innerRadius(.4*j),m=d3.svg.arc().innerRadius(.9*j).outerRadius(.9*j);g.attr("transform","translate("+h/2+","+i/2+")");var n=d3.scale.category10(),o=d3.scale.ordinal().range(n.range());f(c.data)}}c.$watch("data",f,!0)}return{link:c,restrict:"E",scope:{data:"="}}}]),angular.module("capitaloneApp").controller("DescriptiveCtrl",["$scope","$http","$q","dataService",function(a,b,c,d){function e(a){var b=["January","February","March","April","May","June","July","August","September","October","November","December"];return a.forEach(function(a,c){a.date_object=new Date(a.open_date),a.month=b[a.date_object.getMonth()]}),a}function f(a,b){var c=d3.nest().key(function(a){return a[b]}).rollup(function(c){return{label:c[0][b],size:c.length,value:100*c.length/a.length}}).entries(a);return c.map(function(a){return a.values})}var g=d.getMovies()?e(d.getMovies()):[];a.lollipopData={},a.lollipopData._2014_=g.filter(function(a){return"2014"==a.date_object.getFullYear()}).map(function(a){return{date:a.date_object,text_date:a.open_date,open:+a.opening_gross,close:+a.total_gross,title:a.title}}).sort(function(a,b){return d3.descending(a.total_gross,b.total_gross)}),a.lollipopData._2015_=g.filter(function(a){return"2015"==a.date_object.getFullYear()}).map(function(a){return{date:a.date_object,text_date:a.open_date,open:+a.opening_gross,close:+a.total_gross,title:a.title}}).sort(function(a,b){return d3.descending(a.total_gross,b.total_gross)}),a.lollipopData._2016_=g.filter(function(a){return"2016"==a.date_object.getFullYear()}).map(function(a){return{date:a.date_object,text_date:a.open_date,open:+a.opening_gross,close:+a.total_gross,title:a.title}}).sort(function(a,b){return d3.descending(a.total_gross,b.total_gross)}),a.fetchingData=!1,a.donut_data={},a.donut_data.genre=f(g,"genre").sort(function(a,b){return d3.descending(a.value,b.value)}),a.donut_data.studio=f(g,"studio").sort(function(a,b){return d3.descending(a.value,b.value)}),a.donut_data.month=f(g,"month").sort(function(a,b){return d3.descending(a.value,b.value)})}]),angular.module("capitaloneApp").factory("dataService",function(){var a={movies:""};return{getMovies:function(){return a.movies},setMovies:function(b){a.movies=b}}}),angular.module("capitaloneApp").directive("lollipop",["$filter","$timeout",function(a,b){function c(a,b,c){function d(){if(a.data&&null!=a.data){var c={top:30,right:20,bottom:30,left:100},d=1100-c.left-c.right,e=230-c.top-c.bottom,f=(d3.time.format("%d-%b-%y").parse,d3.time.scale().range([0,d])),g=d3.scale.linear().range([e,0]),h=d3.svg.axis().scale(f).orient("bottom").ticks(12),i=d3.svg.axis().scale(g).orient("left").ticks(5),j=(d3.svg.line().x(function(a){return f(a.date)}).y(function(a){return g(a.close)}),d3.select(b[0]).append("svg").attr("width",d+c.left+c.right).attr("height",e+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")")),k=a.data;f.domain(d3.extent(k,function(a){return a.date})).nice(),g.domain([0,d3.max(k,function(a){return a.close})]).nice(),j.selectAll("rect").data(k).enter().append("rect").attr("class","line").attr("fill","#ccc").attr("x",function(a){return f(a.date)-.5}).attr("width",function(a){return 1}).attr("y",function(a){return g(a.close)}).attr("height",function(a){return g(a.open)-g(a.close)}),j.selectAll("dot").data(k).enter().append("circle").attr("fill","#ccc").attr("r",2.5).attr("cx",function(a){return f(a.date)}).attr("cy",function(a){return g(a.close)}),j.selectAll("dot").data(k).enter().append("circle").attr("fill","#000").attr("r",2.5).attr("cx",function(a){return f(a.date)}).attr("cy",function(a){return g(a.open)}).on("mouseover",function(a){d3.select(this).style("fill","red"),j.append("text").attr("id","date-text").attr("x",function(){return f(a.date)}).attr("y",function(){return g(a.close)-12}).attr("dy",".35em").attr("pointer-events","none").attr("fill","red").style("text-anchor","middle").style("font-size","10px").text(a.text_date),j.append("text").attr("id","title-text").attr("x",function(){return f(a.date)}).attr("y",function(){return g(a.close)-24}).attr("dy",".35em").attr("pointer-events","none").attr("fill","#000").style("text-anchor","middle").style("font-size","10px").text(a.title)}).on("mouseout",function(a){d3.select(this).style("fill","#000"),d3.select("svg text#date-text").remove(),d3.select("svg text#title-text").remove()}),j.append("g").attr("class","x axis").attr("transform","translate(0,"+e+")").call(h),j.append("g").attr("class","y axis").call(i)}}a.$watch("data",d,!0)}return{link:c,restrict:"E",scope:{data:"="}}}]),angular.module("capitaloneApp").directive("tradespaceScatter",function(){function a(a,b,c){function d(){function d(){j=d3.scale.linear().domain([0,d3.max(l,function(a){return a[q]})]).range([20,s-210]).nice(),k=d3.scale.linear().domain([0,d3.max(l,function(a){return a[r]})]).range([t-20,100]).nice()}function e(){d3.select("#x-axis-menu").selectAll("li").classed("selected",function(a){return a.metric===q}),d3.select("#y-axis-menu").selectAll("li").classed("selected",function(a){return a.metric===r})}function f(b){d(),d3.select("svg g.chart").selectAll("circle").transition().duration(2e3).ease("quad-out").attr("cx",function(a){return isNaN(a[q])?d3.select(this).attr("cx"):j(a[q])}).attr("cy",function(a){return isNaN(a[r])?d3.select(this).attr("cy"):k(a[r])}).attr("r",function(a){return d3.select(this).classed("selected")?isNaN(a[q])||isNaN(a[r])?0:v:isNaN(a[q])||isNaN(a[r])||-1==a[q]?0:u}),0!=y.length&&d3.select("svg g.chart").selectAll("svg.circle-label").data(y).transition().duration(2e3).ease("quad-out").attr("x",function(a){return j(a.data[q])}).attr("y",function(a){return k(a.data[r])}),d3.select("#xAxis").transition().call(g),d3.select("#yAxis").transition().call(h),d3.select("#xLabel").text(a.currentXMetric.name),d3.select("#yLabel").text(a.currentYMetric.name)}function g(a){a.call(d3.svg.axis().scale(j).orient("bottom"))}function h(a){a.call(d3.svg.axis().scale(k).orient("left"))}function i(a,b){a.each(function(){for(var a,c=d3.select(this),d=c.text().split(/ +/).reverse(),e=[],f=0,g=1.1,h=c.attr("y"),i=c.attr("x"),j=0,k=c.text(null).append("tspan").attr("x",i).attr("y",h).attr("dy",j+"em");a=d.pop();)e.push(a),k.text(e.join(" ")),k.node().getComputedTextLength()>b&&(e.pop(),k.text(e.join(" ")),e=[a],k=c.append("tspan").attr("x",i).attr("y",h).attr("dy",++f*g+j+"em").text(a))})}if(d3.select("svg#scatter-plot").remove(),d3.select("div#legend-scatter svg").remove(),d3.select("#x-axis-menu").selectAll("li").remove(),d3.select("#y-axis-menu").selectAll("li").remove(),a.data&&0!=a.data.length){var j,k,l=a.data,m=a.plot,n=a.colorBy,o=a.axisMetricsX,p=a.axisMetricsY,q=a.currentXMetric.metric,r=a.currentYMetric.metric,s=c.w?+c.w:750,t=c.h?+c.h:560,u=c.r?+c.r:5,v=u+2,w=s-200,x=[100,-60],y=[],z=function(a){return a[n]},A=d3.scale.category10(),B=d3.select(b[0]).append("svg").attr("id","scatter-plot").attr("width",s).attr("height",t);B.append("g").classed("chart",!0).attr("width",w).attr("transform","translate("+x[0]+","+x[1]+")"),d3.select("ul#x-axis-menu").selectAll("li").data(o).enter().append("li").attr("class",function(a){return a}).text(function(a){return a.name}).classed("selected",function(a){return a.metric===q}).on("click",function(b){a.$apply(function(){a.currentXMetric=b}),q=b.metric,f(),e()}),d3.select("ul#y-axis-menu").selectAll("li").data(p).enter().append("li").attr("class",function(a){return a}).text(function(a){return a.name}).classed("selected",function(a){return a.metric===r}).on("click",function(b){a.$apply(function(){a.currentYMetric=b}),r=b.metric,f(),e()}),d3.select("svg g.chart").append("text").attr({id:"xLabel","text-anchor":"end",x:s-210,y:t+2}).text(a.currentXMetric.name),d3.select("svg g.chart").append("text").attr({id:"yLabel","text-anchor":"end",transform:"translate(5,100)rotate(-90)"}).text(a.currentYMetric.name),d(),e();var C=d3.select("svg g.chart").selectAll("circle").data(l);C.enter().append("circle").attr("id",function(a){return a[m.key]}).attr("r",function(a){return isNaN(a[q])||isNaN(a[r])||-1==a[q]||-1==a[r]?0:u}).attr("cx",function(a){return isNaN(a[q])?d3.select(this).attr("cx"):j(a[q])}).attr("cy",t-20).style("fill",function(a){return A(z(a))}).style({cursor:"pointer",stroke:"#fff","stroke-width":"1px",opacity:.7}).on("mouseover",function(b){a.$apply(function(){a.selectedCircle=b}),d3.select(this).style({fill:"black",opacity:1}),d3.select("svg g.chart").append("line").attr("class","y-indicator").attr("x1",j(b[q])).attr("y1",k(b[r])+10).attr("x2",j(b[q])).attr("y2",k(b[r])+10).style({stroke:"#333","stroke-width":"2px","stroke-dasharray":"2, 1"}).transition().duration(350).attr("y2",k(0)+30),d3.select("svg g.chart").append("line").attr("class","x-indicator").attr("x1",j(b[q])-10).attr("y1",k(b[r])).attr("x2",j(b[q])-10).attr("y2",k(b[r])).style({stroke:"#333","stroke-width":"2px","stroke-dasharray":"2, 1"}).transition().duration(350).attr("x2",j(0)-30),d3.select("svg g.chart").append("rect").attr("class","metric-indicator").attr("x",j(b[q])+8).attr("y",k(b[r])-43).style({width:80,height:34,fill:"black"}),d3.select("svg g.chart").append("text").attr("class","y-metric-indicator").attr("x",j(b[q])+14).attr("y",k(b[r])-29).style({opacity:1,fill:"white","text-anchor":"right","font-size":"11px"}).text("y : "+b[r]),d3.select("svg g.chart").append("text").attr("class","x-metric-indicator").attr("x",j(b[q])+14).attr("y",k(b[r])+14-29).style({opacity:1,fill:"white","text-anchor":"right","font-size":"11px"}).text("x : "+b[q])}).on("click",function(a){d3.select(this).classed("selected")?(d3.select("svg g.chart svg.circle"+a[m.key]).remove(),d3.select(this).classed("selected",!1).style({stroke:"#fff","stroke-width":"1px",opacity:.7}).attr("r",u),y=y.filter(function(b){return b.key!==a[m.key]})):(d3.select(this).classed("selected",!0).style({stroke:"#000","stroke-width":"2px",opacity:1}).attr("r",v),d3.select("svg g.chart").append("svg").attr("class","circle-label circle"+a[m.key]).attr("x",j(a[q])).attr("y",k(a[r])).append("text").style({opacity:1,fill:"#aaa","text-anchor":"right","font-size":"10px"}).attr("x",10).attr("y",15).text(a[m.key]).call(i,130),y.push({key:a[m.key],data:a}))}).on("mouseout",function(b){d3.select("svg g.chart line.x-indicator").remove(),d3.select("svg g.chart line.y-indicator").remove(),d3.select("svg g.chart text.x-metric-indicator").remove(),d3.select("svg g.chart text.y-metric-indicator").remove(),d3.select("svg g.chart rect.metric-indicator").remove(),a.$apply(function(){a.selectedCircle=null}),d3.select(this).style("fill",function(a){return A(z(a))}),d3.select(this).style("opacity",.7)}).transition().duration(1e3).delay(100).ease("exp").attr("cy",function(a){return isNaN(a[r])?d3.select(this).attr("cy"):k(a[r])});var D=d3.select("legend-scatter").append("svg").attr("width",280).attr("height",d3.max([90,20*A.domain().length])).selectAll(".legend").data(A.domain()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+20*b+")"});D.append("circle").attr({cx:8,
cy:8,r:8}).style("opacity",1).style("fill",A),D.append("text").attr({x:24,y:7,dy:".35em"}).text(function(a){return a}),d3.select("svg g.chart").append("g").attr({transform:"translate(0, "+(t+10)+")",id:"xAxis"}).call(g),d3.select("svg g.chart").append("g").attr({transform:"translate(-10, 0)",id:"yAxis"}).call(h)}}a.$watch("data",d,!0)}return{link:a,restrict:"E",scope:{data:"=",plot:"=",colorBy:"=",axisMetricsY:"=",currentYMetric:"=",axisMetricsX:"=",currentXMetric:"=",selectedCircle:"="}}}),angular.module("capitaloneApp").controller("TradespaceExplorationCtrl",["$scope","$http","$q","dataService",function(a,b,c,d){function e(b){a.plotKey={key:b[0],text:b[0]},a.colorBy=b[b.length-1],a.xAxisMetrics=[],a.yAxisMetrics=[];for(var c=0;c<b.length;c++)a.xAxisMetrics[c]={name:b[c],metric:b[c]},a.yAxisMetrics[c]={name:b[c],metric:b[c]};a.selectedXMetric=a.xAxisMetrics[0],a.selectedYMetric=a.yAxisMetrics[1]}a.init=function(){function b(){a.csv={content:null,header:!0,headerVisible:!0,separator:",",separatorVisible:!1,result:null,encoding:"ISO-8859-1",encodingVisible:!1,uploadButtonLabel:"upload a csv file"}}b(),a.tradespaceData=[]},a.$watch("csv.result",function(b,c){if(b!==c){var d=Object.keys(a.csv.result[0]);a.tradespaceData=a.csv.result.map(function(a){for(var b={},c=0;c<d.length;c++)b[d[c]]=+a[d[c]];return b}),e(d)}},!0),a.init()}]);